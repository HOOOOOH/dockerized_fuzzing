<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>LCOV - trace.lcov_info_final - orthrus/gain_analysis.c</title>
  <link rel="stylesheet" type="text/css" href="../gcov.css">
</head>

<body>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="title">LCOV - code coverage report</td></tr>
    <tr><td class="ruler"><img src="../glass.png" width=3 height=3 alt=""></td></tr>

    <tr>
      <td width="100%">
        <table cellpadding=1 border=0 width="100%">
          <tr>
            <td width="10%" class="headerItem">Current view:</td>
            <td width="35%" class="headerValue"><a href="../index.html">top level</a> - <a href="index.html">orthrus</a> - gain_analysis.c<span style="font-size: 80%;"> (source / <a href="gain_analysis.c.func-sort-c.html">functions</a>)</span></td>
            <td width="5%"></td>
            <td width="15%"></td>
            <td width="10%" class="headerCovTableHead">Hit</td>
            <td width="10%" class="headerCovTableHead">Total</td>
            <td width="15%" class="headerCovTableHead">Coverage</td>
          </tr>
          <tr>
            <td class="headerItem">Test:</td>
            <td class="headerValue">trace.lcov_info_final</td>
            <td></td>
            <td class="headerItem">Lines:</td>
            <td class="headerCovTableEntry">175</td>
            <td class="headerCovTableEntry">191</td>
            <td class="headerCovTableEntryHi">91.6 %</td>
          </tr>
          <tr>
            <td class="headerItem">Date:</td>
            <td class="headerValue">2019-09-05 12:03:35</td>
            <td></td>
            <td class="headerItem">Functions:</td>
            <td class="headerCovTableEntry">8</td>
            <td class="headerCovTableEntry">9</td>
            <td class="headerCovTableEntryMed">88.9 %</td>
          </tr>
          <tr><td><img src="../glass.png" width=3 height=3 alt=""></td></tr>
        </table>
      </td>
    </tr>

    <tr><td class="ruler"><img src="../glass.png" width=3 height=3 alt=""></td></tr>
  </table>

  <table cellpadding=0 cellspacing=0 border=0>
    <tr>
      <td><br></td>
    </tr>
    <tr>
      <td>
<pre class="sourceHeading">          Line data    Source code</pre>
<pre class="source">
<a name="1"><span class="lineNum">       1 </span>            : /*</a>
<span class="lineNum">       2 </span>            :  *  ReplayGainAnalysis - analyzes input samples and give the recommended dB change
<span class="lineNum">       3 </span>            :  *  Copyright (C) 2001-2009 David Robinson and Glen Sawyer
<span class="lineNum">       4 </span>            :  *  Improvements and optimizations added by Frank Klemm, and by Marcel Müller 
<span class="lineNum">       5 </span>            :  *
<span class="lineNum">       6 </span>            :  *  This library is free software; you can redistribute it and/or
<span class="lineNum">       7 </span>            :  *  modify it under the terms of the GNU Lesser General Public
<span class="lineNum">       8 </span>            :  *  License as published by the Free Software Foundation; either
<span class="lineNum">       9 </span>            :  *  version 2.1 of the License, or (at your option) any later version.
<span class="lineNum">      10 </span>            :  *
<span class="lineNum">      11 </span>            :  *  This library is distributed in the hope that it will be useful,
<span class="lineNum">      12 </span>            :  *  but WITHOUT ANY WARRANTY; without even the implied warranty of
<span class="lineNum">      13 </span>            :  *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
<span class="lineNum">      14 </span>            :  *  Lesser General Public License for more details.
<span class="lineNum">      15 </span>            :  *
<span class="lineNum">      16 </span>            :  *  You should have received a copy of the GNU Lesser General Public
<span class="lineNum">      17 </span>            :  *  License along with this library; if not, write to the Free Software
<span class="lineNum">      18 </span>            :  *  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
<span class="lineNum">      19 </span>            :  *
<span class="lineNum">      20 </span>            :  *  concept and filter values by David Robinson (David@Robinson.org)
<span class="lineNum">      21 </span>            :  *    -- blame him if you think the idea is flawed
<span class="lineNum">      22 </span>            :  *  original coding by Glen Sawyer (mp3gain@hotmail.com)
<span class="lineNum">      23 </span>            :  *    -- blame him if you think this runs too slowly, or the coding is otherwise flawed
<span class="lineNum">      24 </span>            :  *
<span class="lineNum">      25 </span>            :  *  lots of code improvements by Frank Klemm ( http://www.uni-jena.de/~pfk/mpp/ )
<span class="lineNum">      26 </span>            :  *    -- credit him for all the _good_ programming ;)
<span class="lineNum">      27 </span>            :  *
<span class="lineNum">      28 </span>            :  *
<span class="lineNum">      29 </span>            :  *  For an explanation of the concepts and the basic algorithms involved, go to:
<span class="lineNum">      30 </span>            :  *    http://www.replaygain.org/
<span class="lineNum">      31 </span>            :  */
<span class="lineNum">      32 </span>            : 
<span class="lineNum">      33 </span>            : /*
<span class="lineNum">      34 </span>            :  *  Here's the deal. Call
<span class="lineNum">      35 </span>            :  *
<span class="lineNum">      36 </span>            :  *    InitGainAnalysis ( long samplefreq );
<span class="lineNum">      37 </span>            :  *
<span class="lineNum">      38 </span>            :  *  to initialize everything. Call
<span class="lineNum">      39 </span>            :  *
<span class="lineNum">      40 </span>            :  *    AnalyzeSamples ( const Float_t*  left_samples,
<span class="lineNum">      41 </span>            :  *                     const Float_t*  right_samples,
<span class="lineNum">      42 </span>            :  *                     size_t          num_samples,
<span class="lineNum">      43 </span>            :  *                     int             num_channels );
<span class="lineNum">      44 </span>            :  *
<span class="lineNum">      45 </span>            :  *  as many times as you want, with as many or as few samples as you want.
<span class="lineNum">      46 </span>            :  *  If mono, pass the sample buffer in through left_samples, leave
<span class="lineNum">      47 </span>            :  *  right_samples NULL, and make sure num_channels = 1.
<span class="lineNum">      48 </span>            :  *
<span class="lineNum">      49 </span>            :  *    GetTitleGain()
<span class="lineNum">      50 </span>            :  *
<span class="lineNum">      51 </span>            :  *  will return the recommended dB level change for all samples analyzed
<span class="lineNum">      52 </span>            :  *  SINCE THE LAST TIME you called GetTitleGain() OR InitGainAnalysis().
<span class="lineNum">      53 </span>            :  *
<span class="lineNum">      54 </span>            :  *    GetAlbumGain()
<span class="lineNum">      55 </span>            :  *
<span class="lineNum">      56 </span>            :  *  will return the recommended dB level change for all samples analyzed
<span class="lineNum">      57 </span>            :  *  since InitGainAnalysis() was called and finalized with GetTitleGain().
<span class="lineNum">      58 </span>            :  *
<span class="lineNum">      59 </span>            :  *  Pseudo-code to process an album:
<span class="lineNum">      60 </span>            :  *
<span class="lineNum">      61 </span>            :  *    Float_t       l_samples [4096];
<span class="lineNum">      62 </span>            :  *    Float_t       r_samples [4096];
<span class="lineNum">      63 </span>            :  *    size_t        num_samples;
<span class="lineNum">      64 </span>            :  *    unsigned int  num_songs;
<span class="lineNum">      65 </span>            :  *    unsigned int  i;
<span class="lineNum">      66 </span>            :  *
<span class="lineNum">      67 </span>            :  *    InitGainAnalysis ( 44100 );
<span class="lineNum">      68 </span>            :  *    for ( i = 1; i &lt;= num_songs; i++ ) {
<span class="lineNum">      69 </span>            :  *        while ( ( num_samples = getSongSamples ( song[i], left_samples, right_samples ) ) &gt; 0 )
<span class="lineNum">      70 </span>            :  *            AnalyzeSamples ( left_samples, right_samples, num_samples, 2 );
<span class="lineNum">      71 </span>            :  *        fprintf (&quot;Recommended dB change for song %2d: %+6.2f dB\n&quot;, i, GetTitleGain() );
<span class="lineNum">      72 </span>            :  *    }
<span class="lineNum">      73 </span>            :  *    fprintf (&quot;Recommended dB change for whole album: %+6.2f dB\n&quot;, GetAlbumGain() );
<span class="lineNum">      74 </span>            :  */
<span class="lineNum">      75 </span>            : 
<span class="lineNum">      76 </span>            : /*
<span class="lineNum">      77 </span>            :  *  So here's the main source of potential code confusion:
<span class="lineNum">      78 </span>            :  *
<span class="lineNum">      79 </span>            :  *  The filters applied to the incoming samples are IIR filters,
<span class="lineNum">      80 </span>            :  *  meaning they rely on up to &lt;filter order&gt; number of previous samples
<span class="lineNum">      81 </span>            :  *  AND up to &lt;filter order&gt; number of previous filtered samples.
<span class="lineNum">      82 </span>            :  *
<span class="lineNum">      83 </span>            :  *  I set up the AnalyzeSamples routine to minimize memory usage and interface
<span class="lineNum">      84 </span>            :  *  complexity. The speed isn't compromised too much (I don't think), but the
<span class="lineNum">      85 </span>            :  *  internal complexity is higher than it should be for such a relatively
<span class="lineNum">      86 </span>            :  *  simple routine.
<span class="lineNum">      87 </span>            :  *
<span class="lineNum">      88 </span>            :  *  Optimization/clarity suggestions are welcome.
<span class="lineNum">      89 </span>            :  */
<span class="lineNum">      90 </span>            : 
<span class="lineNum">      91 </span>            : #include &lt;stdio.h&gt;
<span class="lineNum">      92 </span>            : #include &lt;stdlib.h&gt;
<span class="lineNum">      93 </span>            : #include &lt;string.h&gt;
<span class="lineNum">      94 </span>            : #include &lt;math.h&gt;
<span class="lineNum">      95 </span>            : 
<span class="lineNum">      96 </span>            : #include &quot;gain_analysis.h&quot;
<span class="lineNum">      97 </span>            : 
<span class="lineNum">      98 </span>            : typedef unsigned short  Uint16_t;
<span class="lineNum">      99 </span>            : typedef signed short    Int16_t;
<span class="lineNum">     100 </span>            : typedef unsigned int    Uint32_t;
<span class="lineNum">     101 </span>            : typedef signed int      Int32_t;
<span class="lineNum">     102 </span>            : 
<span class="lineNum">     103 </span>            : #define YULE_ORDER         10
<span class="lineNum">     104 </span>            : #define BUTTER_ORDER        2
<span class="lineNum">     105 </span>            : #define YULE_FILTER     filterYule
<span class="lineNum">     106 </span>            : #define BUTTER_FILTER   filterButter
<span class="lineNum">     107 </span>            : #define RMS_PERCENTILE      0.95        // percentile which is louder than the proposed level
<span class="lineNum">     108 </span>            : #define MAX_SAMP_FREQ_KHZ  96           // maximum allowed sample frequency [kHz]
<span class="lineNum">     109 </span>            : #define RMS_WINDOW_TIME_MS 50           // Time slice size [ms]
<span class="lineNum">     110 </span>            : #define STEPS_per_dB      100           // Table entries per dB
<span class="lineNum">     111 </span>            : #define MAX_dB            120           // Table entries for 0...MAX_dB (normal max. values are 70...80 dB)
<span class="lineNum">     112 </span>            : 
<span class="lineNum">     113 </span>            : #define MAX_ORDER               (BUTTER_ORDER &gt; YULE_ORDER ? BUTTER_ORDER : YULE_ORDER)
<span class="lineNum">     114 </span>            : #define MAX_SAMPLES_PER_WINDOW  (size_t) (MAX_SAMP_FREQ_KHZ * RMS_WINDOW_TIME_MS + 1)      // max. Samples per Time slice
<span class="lineNum">     115 </span>            : #define PINK_REF                64.82 //298640883795                              // calibration value
<span class="lineNum">     116 </span>            : 
<span class="lineNum">     117 </span>            : Float_t          linprebuf [MAX_ORDER * 2];
<span class="lineNum">     118 </span>            : Float_t*         linpre;                                          // left input samples, with pre-buffer
<span class="lineNum">     119 </span>            : Float_t          lstepbuf  [MAX_SAMPLES_PER_WINDOW + MAX_ORDER];
<span class="lineNum">     120 </span>            : Float_t*         lstep;                                           // left &quot;first step&quot; (i.e. post first filter) samples
<span class="lineNum">     121 </span>            : Float_t          loutbuf   [MAX_SAMPLES_PER_WINDOW + MAX_ORDER];
<span class="lineNum">     122 </span>            : Float_t*         lout;                                            // left &quot;out&quot; (i.e. post second filter) samples
<span class="lineNum">     123 </span>            : Float_t          rinprebuf [MAX_ORDER * 2];
<span class="lineNum">     124 </span>            : Float_t*         rinpre;                                          // right input samples ...
<span class="lineNum">     125 </span>            : Float_t          rstepbuf  [MAX_SAMPLES_PER_WINDOW + MAX_ORDER];
<span class="lineNum">     126 </span>            : Float_t*         rstep;
<span class="lineNum">     127 </span>            : Float_t          routbuf   [MAX_SAMPLES_PER_WINDOW + MAX_ORDER];
<span class="lineNum">     128 </span>            : Float_t*         rout;
<span class="lineNum">     129 </span>            : long             sampleWindow;                                    // number of samples required to reach number of milliseconds required for RMS window
<span class="lineNum">     130 </span>            : long             totsamp;
<span class="lineNum">     131 </span>            : double           lsum;
<span class="lineNum">     132 </span>            : double           rsum;
<span class="lineNum">     133 </span>            : int              freqindex;
<span class="lineNum">     134 </span>            : int              first;
<span class="lineNum">     135 </span>            : static Uint32_t  A [(size_t)(STEPS_per_dB * MAX_dB)];
<span class="lineNum">     136 </span>            : static Uint32_t  B [(size_t)(STEPS_per_dB * MAX_dB)];
<span class="lineNum">     137 </span>            : 
<span class="lineNum">     138 </span>            : // for each filter:
<span class="lineNum">     139 </span>            : // [0] 48 kHz, [1] 44.1 kHz, [2] 32 kHz, [3] 24 kHz, [4] 22050 Hz, [5] 16 kHz, [6] 12 kHz, [7] is 11025 Hz, [8] 8 kHz
<span class="lineNum">     140 </span>            : 
<span class="lineNum">     141 </span>            : #ifdef WIN32
<span class="lineNum">     142 </span>            : #ifndef __GNUC__
<span class="lineNum">     143 </span>            : #pragma warning ( disable : 4305 )
<span class="lineNum">     144 </span>            : #endif
<span class="lineNum">     145 </span>            : #endif
<span class="lineNum">     146 </span>            : 
<span class="lineNum">     147 </span>            : static const Float_t ABYule[12][2*YULE_ORDER + 1] = {
<span class="lineNum">     148 </span>            :         {0.006471345933032, -7.22103125152679, -0.02567678242161,  24.7034187975904,   0.049805860704367, -52.6825833623896,  -0.05823001743528,  77.4825736677539,   0.040611847441914, -82.0074753444205,  -0.010912036887501, 63.1566097101925,  -0.00901635868667,  -34.889569769245,    0.012448886238123, 13.2126852760198,  -0.007206683749426, -3.09445623301669,  0.002167156433951, 0.340344741393305, -0.000261819276949},
<span class="lineNum">     149 </span>            :         {0.015415414474287, -7.19001570087017, -0.07691359399407,  24.4109412087159,   0.196677418516518, -51.6306373580801,  -0.338855114128061, 75.3978476863163,   0.430094579594561, -79.4164552507386,  -0.415015413747894, 61.0373661948115,   0.304942508151101, -33.7446462547014,  -0.166191795926663, 12.8168791146274,   0.063198189938739, -3.01332198541437, -0.015003978694525, 0.223619893831468,  0.001748085184539},
<span class="lineNum">     150 </span>            :         {0.021776466467053, -5.74819833657784, -0.062376961003801, 16.246507961894,    0.107731165328514, -29.9691822642542,  -0.150994515142316, 40.027597579378,    0.170334807313632, -40.3209196052655,  -0.157984942890531, 30.8542077487718,   0.121639833268721, -17.5965138737281,  -0.074094040816409,  7.10690214103873,  0.031282852041061, -1.82175564515191, -0.00755421235941,  0.223619893831468,  0.00117925454213 },
<span class="lineNum">     151 </span>            :     {0.03857599435200,  -3.84664617118067, -0.02160367184185,   7.81501653005538, -0.00123395316851,  -11.34170355132042, -0.00009291677959,  13.05504219327545, -0.01655260341619,  -12.28759895145294,  0.02161526843274,   9.48293806319790, -0.02074045215285,   -5.87257861775999,  0.00594298065125,   2.75465861874613,  0.00306428023191,  -0.86984376593551,  0.00012025322027,  0.13919314567432,   0.00288463683916 },
<span class="lineNum">     152 </span>            :     {0.05418656406430,  -3.47845948550071, -0.02911007808948,   6.36317777566148, -0.00848709379851,   -8.54751527471874, -0.00851165645469,   9.47693607801280, -0.00834990904936,   -8.81498681370155,  0.02245293253339,   6.85401540936998, -0.02596338512915,   -4.39470996079559,  0.01624864962975,   2.19611684890774, -0.00240879051584,  -0.75104302451432,  0.00674613682247,  0.13149317958808,  -0.00187763777362 },
<span class="lineNum">     153 </span>            :     {0.15457299681924,  -2.37898834973084, -0.09331049056315,   2.84868151156327, -0.06247880153653,   -2.64577170229825,  0.02163541888798,   2.23697657451713, -0.05588393329856,   -1.67148153367602,  0.04781476674921,   1.00595954808547,  0.00222312597743,   -0.45953458054983,  0.03174092540049,   0.16378164858596, -0.01390589421898,  -0.05032077717131,  0.00651420667831,  0.02347897407020,  -0.00881362733839 },
<span class="lineNum">     154 </span>            :     {0.30296907319327,  -1.61273165137247, -0.22613988682123,   1.07977492259970, -0.08587323730772,   -0.25656257754070,  0.03282930172664,  -0.16276719120440, -0.00915702933434,   -0.22638893773906, -0.02364141202522,   0.39120800788284, -0.00584456039913,   -0.22138138954925,  0.06276101321749,   0.04500235387352, -0.00000828086748,   0.02005851806501,  0.00205861885564,  0.00302439095741,  -0.02950134983287 },
<span class="lineNum">     155 </span>            :     {0.33642304856132,  -1.49858979367799, -0.25572241425570,   0.87350271418188, -0.11828570177555,    0.12205022308084,  0.11921148675203,  -0.80774944671438, -0.07834489609479,    0.47854794562326, -0.00469977914380,  -0.12453458140019, -0.00589500224440,   -0.04067510197014,  0.05724228140351,   0.08333755284107,  0.00832043980773,  -0.04237348025746, -0.01635381384540,  0.02977207319925,  -0.01760176568150 },
<span class="lineNum">     156 </span>            :     {0.44915256608450,  -0.62820619233671, -0.14351757464547,   0.29661783706366, -0.22784394429749,   -0.37256372942400, -0.01419140100551,   0.00213767857124,  0.04078262797139,   -0.42029820170918, -0.12398163381748,   0.22199650564824,  0.04097565135648,    0.00613424350682,  0.10478503600251,   0.06747620744683, -0.01863887810927,   0.05784820375801, -0.03193428438915,  0.03222754072173,   0.00541907748707 },
<span class="lineNum">     157 </span>            :     {0.56619470757641,  -1.04800335126349, -0.75464456939302,   0.29156311971249,  0.16242137742230,   -0.26806001042947,  0.16744243493672,   0.00819999645858, -0.18901604199609,    0.45054734505008,  0.30931782841830,  -0.33032403314006, -0.27562961986224,    0.06739368333110,  0.00647310677246,  -0.04784254229033,  0.08647503780351,   0.01639907836189, -0.03788984554840,  0.01807364323573,  -0.00588215443421 },
<span class="lineNum">     158 </span>            :     {0.58100494960553,  -0.51035327095184, -0.53174909058578,  -0.31863563325245, -0.14289799034253,   -0.20256413484477,  0.17520704835522,   0.14728154134330,  0.02377945217615,    0.38952639978999,  0.15558449135573,  -0.23313271880868, -0.25344790059353,   -0.05246019024463,  0.01628462406333,  -0.02505961724053,  0.06920467763959,   0.02442357316099, -0.03721611395801,  0.01818801111503,  -0.00749618797172 },
<span class="lineNum">     159 </span>            :     {0.53648789255105,  -0.25049871956020, -0.42163034350696,  -0.43193942311114, -0.00275953611929,   -0.03424681017675,  0.04267842219415,  -0.04678328784242, -0.10214864179676,    0.26408300200955,  0.14590772289388,   0.15113130533216, -0.02459864859345,   -0.17556493366449, -0.11202315195388,  -0.18823009262115, -0.04060034127000,   0.05477720428674,  0.04788665548180,  0.04704409688120,  -0.02217936801134 }
<span class="lineNum">     160 </span>            : };
<span class="lineNum">     161 </span>            : 
<span class="lineNum">     162 </span>            : static const Float_t ABButter[12][2*BUTTER_ORDER + 1] = {
<span class="lineNum">     163 </span>            :         {0.99308203517541, -1.98611621154089, -1.98616407035082,  0.986211929160751, 0.99308203517541 },
<span class="lineNum">     164 </span>            :         {0.992472550461293,-1.98488843762334, -1.98494510092258,  0.979389350028798, 0.992472550461293},
<span class="lineNum">     165 </span>            :         {0.989641019334721,-1.97917472731008, -1.97928203866944,  0.979389350028798, 0.989641019334721},
<span class="lineNum">     166 </span>            :     {0.98621192462708, -1.97223372919527, -1.97242384925416,  0.97261396931306,  0.98621192462708 },
<span class="lineNum">     167 </span>            :     {0.98500175787242, -1.96977855582618, -1.97000351574484,  0.97022847566350,  0.98500175787242 },
<span class="lineNum">     168 </span>            :     {0.97938932735214, -1.95835380975398, -1.95877865470428,  0.95920349965459,  0.97938932735214 },
<span class="lineNum">     169 </span>            :     {0.97531843204928, -1.95002759149878, -1.95063686409857,  0.95124613669835,  0.97531843204928 },
<span class="lineNum">     170 </span>            :     {0.97316523498161, -1.94561023566527, -1.94633046996323,  0.94705070426118,  0.97316523498161 },
<span class="lineNum">     171 </span>            :     {0.96454515552826, -1.92783286977036, -1.92909031105652,  0.93034775234268,  0.96454515552826 },
<span class="lineNum">     172 </span>            :     {0.96009142950541, -1.91858953033784, -1.92018285901082,  0.92177618768381,  0.96009142950541 },
<span class="lineNum">     173 </span>            :     {0.95856916599601, -1.91542108074780, -1.91713833199203,  0.91885558323625,  0.95856916599601 },
<span class="lineNum">     174 </span>            :     {0.94597685600279, -1.88903307939452, -1.89195371200558,  0.89487434461664,  0.94597685600279 }
<span class="lineNum">     175 </span>            : };
<span class="lineNum">     176 </span>            : 
<span class="lineNum">     177 </span>            : 
<span class="lineNum">     178 </span>            : #ifdef WIN32
<span class="lineNum">     179 </span>            : #ifndef __GNUC__
<span class="lineNum">     180 </span>            : #pragma warning ( default : 4305 )
<span class="lineNum">     181 </span>            : #endif
<span class="lineNum">     182 </span>            : #endif
<span class="lineNum">     183 </span>            : 
<span class="lineNum">     184 </span>            : // When calling these filter procedures, make sure that ip[-order] and op[-order] point to real data!
<span class="lineNum">     185 </span>            : 
<span class="lineNum">     186 </span>            : // If your compiler complains that &quot;'operation on 'output' may be undefined&quot;, you can
<span class="lineNum">     187 </span>            : // either ignore the warnings or uncomment the three &quot;y&quot; lines (and comment out the indicated line)
<a name="188"><span class="lineNum">     188 </span>            : </a>
<span class="lineNum">     189 </span>            : static void
<span class="lineNum">     190 </span><span class="lineCov">       1428 : filterYule (const Float_t* input, Float_t* output, size_t nSamples, const Float_t* kernel)</span>
<span class="lineNum">     191 </span>            : {
<span class="lineNum">     192 </span>            : 
<span class="lineNum">     193 </span><span class="lineCov">     482472 :     while (nSamples--) {</span>
<span class="lineNum">     194 </span><span class="lineCov">     479616 :        *output =  1e-10  /* 1e-10 is a hack to avoid slowdown because of denormals */</span>
<span class="lineNum">     195 </span><span class="lineCov">     479616 :          + input [0]  * kernel[0]</span>
<span class="lineNum">     196 </span><span class="lineCov">     479616 :          - output[-1] * kernel[1]</span>
<span class="lineNum">     197 </span><span class="lineCov">     479616 :          + input [-1] * kernel[2]</span>
<span class="lineNum">     198 </span><span class="lineCov">     479616 :          - output[-2] * kernel[3]</span>
<span class="lineNum">     199 </span><span class="lineCov">     479616 :          + input [-2] * kernel[4]</span>
<span class="lineNum">     200 </span><span class="lineCov">     479616 :          - output[-3] * kernel[5]</span>
<span class="lineNum">     201 </span><span class="lineCov">     479616 :          + input [-3] * kernel[6]</span>
<span class="lineNum">     202 </span><span class="lineCov">     479616 :          - output[-4] * kernel[7]</span>
<span class="lineNum">     203 </span><span class="lineCov">     479616 :          + input [-4] * kernel[8]</span>
<span class="lineNum">     204 </span><span class="lineCov">     479616 :          - output[-5] * kernel[9]</span>
<span class="lineNum">     205 </span><span class="lineCov">     479616 :          + input [-5] * kernel[10]</span>
<span class="lineNum">     206 </span><span class="lineCov">     479616 :          - output[-6] * kernel[11]</span>
<span class="lineNum">     207 </span><span class="lineCov">     479616 :          + input [-6] * kernel[12]</span>
<span class="lineNum">     208 </span><span class="lineCov">     479616 :          - output[-7] * kernel[13]</span>
<span class="lineNum">     209 </span><span class="lineCov">     479616 :          + input [-7] * kernel[14]</span>
<span class="lineNum">     210 </span><span class="lineCov">     479616 :          - output[-8] * kernel[15]</span>
<span class="lineNum">     211 </span><span class="lineCov">     479616 :          + input [-8] * kernel[16]</span>
<span class="lineNum">     212 </span><span class="lineCov">     479616 :          - output[-9] * kernel[17]</span>
<span class="lineNum">     213 </span><span class="lineCov">     479616 :          + input [-9] * kernel[18]</span>
<span class="lineNum">     214 </span><span class="lineCov">     479616 :          - output[-10]* kernel[19]</span>
<span class="lineNum">     215 </span><span class="lineCov">     479616 :          + input [-10]* kernel[20];</span>
<span class="lineNum">     216 </span><span class="lineCov">     479616 :         ++output;</span>
<span class="lineNum">     217 </span><span class="lineCov">     479616 :         ++input;</span>
<span class="lineNum">     218 </span>            :     }
<span class="lineNum">     219 </span><span class="lineCov">       1428 : }</span>
<a name="220"><span class="lineNum">     220 </span>            : </a>
<span class="lineNum">     221 </span>            : static void
<span class="lineNum">     222 </span><span class="lineCov">       1428 : filterButter (const Float_t* input, Float_t* output, size_t nSamples, const Float_t* kernel)</span>
<span class="lineNum">     223 </span>            : {   
<span class="lineNum">     224 </span>            : 
<span class="lineNum">     225 </span><span class="lineCov">     482472 :     while (nSamples--) {</span>
<span class="lineNum">     226 </span><span class="lineCov">     479616 :         *output =  </span>
<span class="lineNum">     227 </span><span class="lineCov">     479616 :            input [0]  * kernel[0]</span>
<span class="lineNum">     228 </span><span class="lineCov">     479616 :          - output[-1] * kernel[1]</span>
<span class="lineNum">     229 </span><span class="lineCov">     479616 :          + input [-1] * kernel[2]</span>
<span class="lineNum">     230 </span><span class="lineCov">     479616 :          - output[-2] * kernel[3]</span>
<span class="lineNum">     231 </span><span class="lineCov">     479616 :          + input [-2] * kernel[4];</span>
<span class="lineNum">     232 </span><span class="lineCov">     479616 :         ++output;</span>
<span class="lineNum">     233 </span><span class="lineCov">     479616 :         ++input;</span>
<span class="lineNum">     234 </span>            :     }
<span class="lineNum">     235 </span><span class="lineCov">       1428 : }</span>
<span class="lineNum">     236 </span>            : 
<span class="lineNum">     237 </span>            : 
<span class="lineNum">     238 </span>            : // returns a INIT_GAIN_ANALYSIS_OK if successful, INIT_GAIN_ANALYSIS_ERROR if not
<a name="239"><span class="lineNum">     239 </span>            : </a>
<span class="lineNum">     240 </span>            : int
<span class="lineNum">     241 </span><span class="lineCov">        270 : ResetSampleFrequency ( long samplefreq ) {</span>
<span class="lineNum">     242 </span>            :     int  i;
<span class="lineNum">     243 </span>            : 
<span class="lineNum">     244 </span>            :     // zero out initial values
<span class="lineNum">     245 </span><span class="lineCov">       2970 :     for ( i = 0; i &lt; MAX_ORDER; i++ )</span>
<span class="lineNum">     246 </span><span class="lineCov">       2700 :         linprebuf[i] = lstepbuf[i] = loutbuf[i] = rinprebuf[i] = rstepbuf[i] = routbuf[i] = 0.;</span>
<span class="lineNum">     247 </span>            : 
<span class="lineNum">     248 </span><span class="lineCov">        270 :     switch ( (int)(samplefreq) ) {</span>
<span class="lineNum">     249 </span><span class="lineNoCov">          0 :         case 96000: freqindex = 0; break;</span>
<span class="lineNum">     250 </span><span class="lineNoCov">          0 :         case 88200: freqindex = 1; break;</span>
<span class="lineNum">     251 </span><span class="lineNoCov">          0 :         case 64000: freqindex = 2; break;</span>
<span class="lineNum">     252 </span><span class="lineCov">          5 :         case 48000: freqindex = 3; break;</span>
<span class="lineNum">     253 </span><span class="lineCov">         73 :         case 44100: freqindex = 4; break;</span>
<span class="lineNum">     254 </span><span class="lineCov">         14 :         case 32000: freqindex = 5; break;</span>
<span class="lineNum">     255 </span><span class="lineCov">          4 :         case 24000: freqindex = 6; break;</span>
<span class="lineNum">     256 </span><span class="lineCov">         39 :         case 22050: freqindex = 7; break;</span>
<span class="lineNum">     257 </span><span class="lineCov">          9 :         case 16000: freqindex = 8; break;</span>
<span class="lineNum">     258 </span><span class="lineCov">          4 :         case 12000: freqindex = 9; break;</span>
<span class="lineNum">     259 </span><span class="lineCov">        116 :         case 11025: freqindex = 10; break;</span>
<span class="lineNum">     260 </span><span class="lineCov">          6 :         case  8000: freqindex = 11; break;</span>
<span class="lineNum">     261 </span><span class="lineNoCov">          0 :         default:    return INIT_GAIN_ANALYSIS_ERROR;</span>
<span class="lineNum">     262 </span>            :     }
<span class="lineNum">     263 </span>            : 
<span class="lineNum">     264 </span><span class="lineCov">        270 :     sampleWindow = (int) ceil (samplefreq * RMS_WINDOW_TIME_MS / 1000.);</span>
<span class="lineNum">     265 </span>            : 
<span class="lineNum">     266 </span><span class="lineCov">        270 :     lsum         = 0.;</span>
<span class="lineNum">     267 </span><span class="lineCov">        270 :     rsum         = 0.;</span>
<span class="lineNum">     268 </span><span class="lineCov">        270 :     totsamp      = 0;</span>
<span class="lineNum">     269 </span>            : 
<span class="lineNum">     270 </span><span class="lineCov">        270 :     memset ( A, 0, sizeof(A) );</span>
<span class="lineNum">     271 </span>            : 
<span class="lineNum">     272 </span><span class="lineCov">        270 :     return INIT_GAIN_ANALYSIS_OK;</span>
<span class="lineNum">     273 </span>            : }
<a name="274"><span class="lineNum">     274 </span>            : </a>
<span class="lineNum">     275 </span>            : int
<span class="lineNum">     276 </span><span class="lineCov">        270 : InitGainAnalysis ( long samplefreq )</span>
<span class="lineNum">     277 </span>            : {
<span class="lineNum">     278 </span><span class="lineCov">        270 :     if (ResetSampleFrequency(samplefreq) != INIT_GAIN_ANALYSIS_OK) {</span>
<span class="lineNum">     279 </span><span class="lineNoCov">          0 :         return INIT_GAIN_ANALYSIS_ERROR;</span>
<span class="lineNum">     280 </span>            :     }
<span class="lineNum">     281 </span>            : 
<span class="lineNum">     282 </span><span class="lineCov">        270 :     linpre       = linprebuf + MAX_ORDER;</span>
<span class="lineNum">     283 </span><span class="lineCov">        270 :     rinpre       = rinprebuf + MAX_ORDER;</span>
<span class="lineNum">     284 </span><span class="lineCov">        270 :     lstep        = lstepbuf  + MAX_ORDER;</span>
<span class="lineNum">     285 </span><span class="lineCov">        270 :     rstep        = rstepbuf  + MAX_ORDER;</span>
<span class="lineNum">     286 </span><span class="lineCov">        270 :     lout         = loutbuf   + MAX_ORDER;</span>
<span class="lineNum">     287 </span><span class="lineCov">        270 :     rout         = routbuf   + MAX_ORDER;</span>
<span class="lineNum">     288 </span>            : 
<span class="lineNum">     289 </span><span class="lineCov">        270 :     memset ( B, 0, sizeof(B) );</span>
<span class="lineNum">     290 </span>            : 
<span class="lineNum">     291 </span><span class="lineCov">        270 :     return INIT_GAIN_ANALYSIS_OK;</span>
<span class="lineNum">     292 </span>            : }
<span class="lineNum">     293 </span>            : 
<a name="294"><span class="lineNum">     294 </span>            : // returns GAIN_ANALYSIS_OK if successful, GAIN_ANALYSIS_ERROR if not</a>
<span class="lineNum">     295 </span>            : 
<span class="lineNum">     296 </span><span class="lineCov">     479616 : static __inline double fsqr(const double d)</span>
<span class="lineNum">     297 </span><span class="lineCov">     479616 : {  return d*d;</span>
<span class="lineNum">     298 </span>            : }
<a name="299"><span class="lineNum">     299 </span>            : </a>
<span class="lineNum">     300 </span>            : int
<span class="lineNum">     301 </span><span class="lineCov">        282 : AnalyzeSamples ( const Float_t* left_samples, const Float_t* right_samples, size_t num_samples, int num_channels )</span>
<span class="lineNum">     302 </span>            : {
<span class="lineNum">     303 </span>            :     const Float_t*  curleft;
<span class="lineNum">     304 </span>            :     const Float_t*  curright;
<span class="lineNum">     305 </span>            :     long            batchsamples;
<span class="lineNum">     306 </span>            :     long            cursamples;
<span class="lineNum">     307 </span>            :     long            cursamplepos;
<span class="lineNum">     308 </span>            :     int             i;
<span class="lineNum">     309 </span>            : 
<span class="lineNum">     310 </span><span class="lineCov">        282 :     if ( num_samples == 0 )</span>
<span class="lineNum">     311 </span><span class="lineNoCov">          0 :         return GAIN_ANALYSIS_OK;</span>
<span class="lineNum">     312 </span>            : 
<span class="lineNum">     313 </span><span class="lineCov">        282 :     cursamplepos = 0;</span>
<span class="lineNum">     314 </span><span class="lineCov">        282 :     batchsamples = (long)num_samples;</span>
<span class="lineNum">     315 </span>            : 
<span class="lineNum">     316 </span><span class="lineCov">        282 :     switch ( num_channels) {</span>
<span class="lineNum">     317 </span><span class="lineCov">         79 :     case  1: right_samples = left_samples;</span>
<span class="lineNum">     318 </span><span class="lineCov">        282 :     case  2: break;</span>
<span class="lineNum">     319 </span><span class="lineNoCov">          0 :     default: return GAIN_ANALYSIS_ERROR;</span>
<span class="lineNum">     320 </span>            :     }
<span class="lineNum">     321 </span>            : 
<span class="lineNum">     322 </span><span class="lineCov">        282 :     if ( num_samples &lt; MAX_ORDER ) {</span>
<span class="lineNum">     323 </span><span class="lineNoCov">          0 :         memcpy ( linprebuf + MAX_ORDER, left_samples , num_samples * sizeof(Float_t) );</span>
<span class="lineNum">     324 </span><span class="lineNoCov">          0 :         memcpy ( rinprebuf + MAX_ORDER, right_samples, num_samples * sizeof(Float_t) );</span>
<span class="lineNum">     325 </span>            :     }
<span class="lineNum">     326 </span>            :     else {
<span class="lineNum">     327 </span><span class="lineCov">        282 :         memcpy ( linprebuf + MAX_ORDER, left_samples,  MAX_ORDER   * sizeof(Float_t) );</span>
<span class="lineNum">     328 </span><span class="lineCov">        282 :         memcpy ( rinprebuf + MAX_ORDER, right_samples, MAX_ORDER   * sizeof(Float_t) );</span>
<span class="lineNum">     329 </span>            :     }
<span class="lineNum">     330 </span>            : 
<span class="lineNum">     331 </span><span class="lineCov">       1278 :     while ( batchsamples &gt; 0 ) {</span>
<span class="lineNum">     332 </span><span class="lineCov">        714 :         cursamples = batchsamples &gt; sampleWindow-totsamp  ?  sampleWindow - totsamp  :  batchsamples;</span>
<span class="lineNum">     333 </span><span class="lineCov">        714 :         if ( cursamplepos &lt; MAX_ORDER ) {</span>
<span class="lineNum">     334 </span><span class="lineCov">        282 :             curleft  = linpre+cursamplepos;</span>
<span class="lineNum">     335 </span><span class="lineCov">        282 :             curright = rinpre+cursamplepos;</span>
<span class="lineNum">     336 </span><span class="lineCov">        282 :             if (cursamples &gt; MAX_ORDER - cursamplepos )</span>
<span class="lineNum">     337 </span><span class="lineCov">        282 :                 cursamples = MAX_ORDER - cursamplepos;</span>
<span class="lineNum">     338 </span>            :         }
<span class="lineNum">     339 </span>            :         else {
<span class="lineNum">     340 </span><span class="lineCov">        432 :             curleft  = left_samples  + cursamplepos;</span>
<span class="lineNum">     341 </span><span class="lineCov">        432 :             curright = right_samples + cursamplepos;</span>
<span class="lineNum">     342 </span>            :         }
<span class="lineNum">     343 </span>            : 
<span class="lineNum">     344 </span><span class="lineCov">        714 :         YULE_FILTER ( curleft , lstep + totsamp, cursamples, ABYule[freqindex]);</span>
<span class="lineNum">     345 </span><span class="lineCov">        714 :         YULE_FILTER ( curright, rstep + totsamp, cursamples, ABYule[freqindex]);</span>
<span class="lineNum">     346 </span>            : 
<span class="lineNum">     347 </span><span class="lineCov">        714 :         BUTTER_FILTER ( lstep + totsamp, lout + totsamp, cursamples, ABButter[freqindex]);</span>
<span class="lineNum">     348 </span><span class="lineCov">        714 :         BUTTER_FILTER ( rstep + totsamp, rout + totsamp, cursamples, ABButter[freqindex]);</span>
<span class="lineNum">     349 </span>            : 
<span class="lineNum">     350 </span><span class="lineCov">        714 :         curleft = lout + totsamp;                   // Get the squared values</span>
<span class="lineNum">     351 </span><span class="lineCov">        714 :         curright = rout + totsamp;</span>
<span class="lineNum">     352 </span>            : 
<span class="lineNum">     353 </span><span class="lineCov">        714 :         i = cursamples % 16;</span>
<span class="lineNum">     354 </span><span class="lineCov">       7268 :         while (i--)</span>
<span class="lineNum">     355 </span><span class="lineCov">       5840 :         {   lsum += fsqr(*curleft++);</span>
<span class="lineNum">     356 </span><span class="lineCov">       5840 :             rsum += fsqr(*curright++);</span>
<span class="lineNum">     357 </span>            :         }
<span class="lineNum">     358 </span><span class="lineCov">        714 :         i = cursamples / 16;</span>
<span class="lineNum">     359 </span><span class="lineCov">      16051 :         while (i--)</span>
<span class="lineNum">     360 </span><span class="lineCov">      29246 :         {   lsum += fsqr(curleft[0])</span>
<span class="lineNum">     361 </span><span class="lineCov">      14623 :                   + fsqr(curleft[1])</span>
<span class="lineNum">     362 </span><span class="lineCov">      14623 :                   + fsqr(curleft[2])</span>
<span class="lineNum">     363 </span><span class="lineCov">      14623 :                   + fsqr(curleft[3])</span>
<span class="lineNum">     364 </span><span class="lineCov">      14623 :                   + fsqr(curleft[4])</span>
<span class="lineNum">     365 </span><span class="lineCov">      14623 :                   + fsqr(curleft[5])</span>
<span class="lineNum">     366 </span><span class="lineCov">      14623 :                   + fsqr(curleft[6])</span>
<span class="lineNum">     367 </span><span class="lineCov">      14623 :                   + fsqr(curleft[7])</span>
<span class="lineNum">     368 </span><span class="lineCov">      14623 :                   + fsqr(curleft[8])</span>
<span class="lineNum">     369 </span><span class="lineCov">      14623 :                   + fsqr(curleft[9])</span>
<span class="lineNum">     370 </span><span class="lineCov">      14623 :                   + fsqr(curleft[10])</span>
<span class="lineNum">     371 </span><span class="lineCov">      14623 :                   + fsqr(curleft[11])</span>
<span class="lineNum">     372 </span><span class="lineCov">      14623 :                   + fsqr(curleft[12])</span>
<span class="lineNum">     373 </span><span class="lineCov">      14623 :                   + fsqr(curleft[13])</span>
<span class="lineNum">     374 </span><span class="lineCov">      14623 :                   + fsqr(curleft[14])</span>
<span class="lineNum">     375 </span><span class="lineCov">      14623 :                   + fsqr(curleft[15]);</span>
<span class="lineNum">     376 </span><span class="lineCov">      14623 :             curleft += 16;</span>
<span class="lineNum">     377 </span><span class="lineCov">      29246 :             rsum += fsqr(curright[0])</span>
<span class="lineNum">     378 </span><span class="lineCov">      14623 :                   + fsqr(curright[1])</span>
<span class="lineNum">     379 </span><span class="lineCov">      14623 :                   + fsqr(curright[2])</span>
<span class="lineNum">     380 </span><span class="lineCov">      14623 :                   + fsqr(curright[3])</span>
<span class="lineNum">     381 </span><span class="lineCov">      14623 :                   + fsqr(curright[4])</span>
<span class="lineNum">     382 </span><span class="lineCov">      14623 :                   + fsqr(curright[5])</span>
<span class="lineNum">     383 </span><span class="lineCov">      14623 :                   + fsqr(curright[6])</span>
<span class="lineNum">     384 </span><span class="lineCov">      14623 :                   + fsqr(curright[7])</span>
<span class="lineNum">     385 </span><span class="lineCov">      14623 :                   + fsqr(curright[8])</span>
<span class="lineNum">     386 </span><span class="lineCov">      14623 :                   + fsqr(curright[9])</span>
<span class="lineNum">     387 </span><span class="lineCov">      14623 :                   + fsqr(curright[10])</span>
<span class="lineNum">     388 </span><span class="lineCov">      14623 :                   + fsqr(curright[11])</span>
<span class="lineNum">     389 </span><span class="lineCov">      14623 :                   + fsqr(curright[12])</span>
<span class="lineNum">     390 </span><span class="lineCov">      14623 :                   + fsqr(curright[13])</span>
<span class="lineNum">     391 </span><span class="lineCov">      14623 :                   + fsqr(curright[14])</span>
<span class="lineNum">     392 </span><span class="lineCov">      14623 :                   + fsqr(curright[15]);</span>
<span class="lineNum">     393 </span><span class="lineCov">      14623 :             curright += 16;</span>
<span class="lineNum">     394 </span>            :         }
<span class="lineNum">     395 </span>            : 
<span class="lineNum">     396 </span><span class="lineCov">        714 :         batchsamples -= cursamples;</span>
<span class="lineNum">     397 </span><span class="lineCov">        714 :         cursamplepos += cursamples;</span>
<span class="lineNum">     398 </span><span class="lineCov">        714 :         totsamp      += cursamples;</span>
<span class="lineNum">     399 </span><span class="lineCov">        714 :         if ( totsamp == sampleWindow ) {  // Get the Root Mean Square (RMS) for this set of samples</span>
<span class="lineNum">     400 </span><span class="lineCov">        150 :             double  val  = STEPS_per_dB * 10. * log10 ( (lsum+rsum) / totsamp * 0.5 + 1.e-37 );</span>
<span class="lineNum">     401 </span><span class="lineCov">        150 :             int     ival = (int) val;</span>
<span class="lineNum">     402 </span><span class="lineCov">        150 :             if ( ival &lt;                     0 ) ival = 0;</span>
<span class="lineNum">     403 </span><span class="lineCov">        150 :             if ( ival &gt;= (int)(sizeof(A)/sizeof(*A)) ) ival = sizeof(A)/sizeof(*A) - 1;</span>
<span class="lineNum">     404 </span><span class="lineCov">        150 :             A [ival]++;</span>
<span class="lineNum">     405 </span><span class="lineCov">        150 :             lsum = rsum = 0.;</span>
<span class="lineNum">     406 </span><span class="lineCov">        150 :             memmove ( loutbuf , loutbuf  + totsamp, MAX_ORDER * sizeof(Float_t) );</span>
<span class="lineNum">     407 </span><span class="lineCov">        150 :             memmove ( routbuf , routbuf  + totsamp, MAX_ORDER * sizeof(Float_t) );</span>
<span class="lineNum">     408 </span><span class="lineCov">        150 :             memmove ( lstepbuf, lstepbuf + totsamp, MAX_ORDER * sizeof(Float_t) );</span>
<span class="lineNum">     409 </span><span class="lineCov">        150 :             memmove ( rstepbuf, rstepbuf + totsamp, MAX_ORDER * sizeof(Float_t) );</span>
<span class="lineNum">     410 </span><span class="lineCov">        150 :             totsamp = 0;</span>
<span class="lineNum">     411 </span>            :         }
<span class="lineNum">     412 </span><span class="lineCov">        714 :         if ( totsamp &gt; sampleWindow )   // somehow I really screwed up: Error in programming! Contact author about totsamp &gt; sampleWindow</span>
<span class="lineNum">     413 </span><span class="lineNoCov">          0 :             return GAIN_ANALYSIS_ERROR;</span>
<span class="lineNum">     414 </span>            :     }
<span class="lineNum">     415 </span><span class="lineCov">        282 :     if ( num_samples &lt; MAX_ORDER ) {</span>
<span class="lineNum">     416 </span><span class="lineNoCov">          0 :         memmove ( linprebuf,                           linprebuf + num_samples, (MAX_ORDER-num_samples) * sizeof(Float_t) );</span>
<span class="lineNum">     417 </span><span class="lineNoCov">          0 :         memmove ( rinprebuf,                           rinprebuf + num_samples, (MAX_ORDER-num_samples) * sizeof(Float_t) );</span>
<span class="lineNum">     418 </span><span class="lineNoCov">          0 :         memcpy  ( linprebuf + MAX_ORDER - num_samples, left_samples,          num_samples             * sizeof(Float_t) );</span>
<span class="lineNum">     419 </span><span class="lineNoCov">          0 :         memcpy  ( rinprebuf + MAX_ORDER - num_samples, right_samples,         num_samples             * sizeof(Float_t) );</span>
<span class="lineNum">     420 </span>            :     }
<span class="lineNum">     421 </span>            :     else {
<span class="lineNum">     422 </span><span class="lineCov">        282 :         memcpy  ( linprebuf, left_samples  + num_samples - MAX_ORDER, MAX_ORDER * sizeof(Float_t) );</span>
<span class="lineNum">     423 </span><span class="lineCov">        282 :         memcpy  ( rinprebuf, right_samples + num_samples - MAX_ORDER, MAX_ORDER * sizeof(Float_t) );</span>
<span class="lineNum">     424 </span>            :     }
<span class="lineNum">     425 </span>            : 
<span class="lineNum">     426 </span><span class="lineCov">        282 :     return GAIN_ANALYSIS_OK;</span>
<span class="lineNum">     427 </span>            : }
<span class="lineNum">     428 </span>            : 
<a name="429"><span class="lineNum">     429 </span>            : </a>
<span class="lineNum">     430 </span>            : static Float_t
<span class="lineNum">     431 </span><span class="lineCov">        218 : analyzeResult ( Uint32_t* Array, size_t len )</span>
<span class="lineNum">     432 </span>            : {
<span class="lineNum">     433 </span>            :     Uint32_t  elems;
<span class="lineNum">     434 </span>            :     Int32_t   upper;
<span class="lineNum">     435 </span>            :     size_t    i;
<span class="lineNum">     436 </span>            : 
<span class="lineNum">     437 </span><span class="lineCov">        218 :     elems = 0;</span>
<span class="lineNum">     438 </span><span class="lineCov">    2616218 :     for ( i = 0; i &lt; len; i++ )</span>
<span class="lineNum">     439 </span><span class="lineCov">    2616000 :         elems += Array[i];</span>
<span class="lineNum">     440 </span><span class="lineCov">        218 :     if ( elems == 0 )</span>
<span class="lineNum">     441 </span><span class="lineCov">        140 :         return GAIN_NOT_ENOUGH_SAMPLES;</span>
<span class="lineNum">     442 </span>            : 
<span class="lineNum">     443 </span><span class="lineCov">         78 :     upper = (Int32_t) ceil (elems * (1. - RMS_PERCENTILE));</span>
<span class="lineNum">     444 </span><span class="lineCov">     715825 :     for ( i = len; i-- &gt; 0; ) {</span>
<span class="lineNum">     445 </span><span class="lineCov">     715747 :         if ( (upper -= Array[i]) &lt;= 0 )</span>
<span class="lineNum">     446 </span><span class="lineCov">         78 :             break;</span>
<span class="lineNum">     447 </span>            :     }
<span class="lineNum">     448 </span>            : 
<span class="lineNum">     449 </span><span class="lineCov">         78 :     return (Float_t) ((Float_t)PINK_REF - (Float_t)i / (Float_t)STEPS_per_dB);</span>
<span class="lineNum">     450 </span>            : }
<span class="lineNum">     451 </span>            : 
<a name="452"><span class="lineNum">     452 </span>            : </a>
<span class="lineNum">     453 </span>            : Float_t
<span class="lineNum">     454 </span><span class="lineCov">        218 : GetTitleGain ( void )</span>
<span class="lineNum">     455 </span>            : {
<span class="lineNum">     456 </span>            :     Float_t  retval;
<span class="lineNum">     457 </span>            :     int    i;
<span class="lineNum">     458 </span>            : 
<span class="lineNum">     459 </span><span class="lineCov">        218 :     retval = analyzeResult ( A, sizeof(A)/sizeof(*A) );</span>
<span class="lineNum">     460 </span>            : 
<span class="lineNum">     461 </span><span class="lineCov">    2616218 :     for ( i = 0; i &lt; (int)(sizeof(A)/sizeof(*A)); i++ ) {</span>
<span class="lineNum">     462 </span><span class="lineCov">    2616000 :         B[i] += A[i];</span>
<span class="lineNum">     463 </span><span class="lineCov">    2616000 :         A[i]  = 0;</span>
<span class="lineNum">     464 </span>            :     }
<span class="lineNum">     465 </span>            : 
<span class="lineNum">     466 </span><span class="lineCov">       2398 :     for ( i = 0; i &lt; MAX_ORDER; i++ )</span>
<span class="lineNum">     467 </span><span class="lineCov">       2180 :         linprebuf[i] = lstepbuf[i] = loutbuf[i] = rinprebuf[i] = rstepbuf[i] = routbuf[i] = 0.f;</span>
<span class="lineNum">     468 </span>            : 
<span class="lineNum">     469 </span><span class="lineCov">        218 :     totsamp = 0;</span>
<span class="lineNum">     470 </span><span class="lineCov">        218 :     lsum    = rsum = 0.;</span>
<span class="lineNum">     471 </span><span class="lineCov">        218 :     return retval;</span>
<span class="lineNum">     472 </span>            : }
<span class="lineNum">     473 </span>            : 
<a name="474"><span class="lineNum">     474 </span>            : </a>
<span class="lineNum">     475 </span>            : Float_t
<span class="lineNum">     476 </span><span class="lineNoCov">          0 : GetAlbumGain ( void )</span>
<span class="lineNum">     477 </span>            : {
<span class="lineNum">     478 </span><span class="lineNoCov">          0 :     return analyzeResult ( B, sizeof(B)/sizeof(*B) );</span>
<span class="lineNum">     479 </span>            : }
<span class="lineNum">     480 </span>            : 
<span class="lineNum">     481 </span>            : /* end of gain_analysis.c */
</pre>
      </td>
    </tr>
  </table>
  <br>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="ruler"><img src="../glass.png" width=3 height=3 alt=""></td></tr>
    <tr><td class="versionInfo">Generated by: <a href="http://ltp.sourceforge.net/coverage/lcov.php" target="_parent">LCOV version 1.12</a></td></tr>
  </table>
  <br>

</body>
</html>
